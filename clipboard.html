<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NDC Input & Clipboard</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input, button, select { padding: 10px; font-size: 16px; margin: 5px 0; }
  .ndc-row { margin-bottom: 10px; }
  #status { margin-top: 15px; font-weight: bold; color: green; }
  #customInterval { width: 120px; display: none; }
  .valid { border: 2px solid green; }
  .invalid { border: 2px solid red; }
</style>
</head>
<body>

<h2>Send NDC Clipboard</h2>
<button onclick="addNDCInput()">Add NDC Input</button>
<br><br>

<label for="intervalSelect">Copy Interval:</label>
<select id="intervalSelect">
  <option value="5">5 seconds</option>
  <option value="10" selected>10 seconds</option>
  <option value="15">15 seconds</option>
  <option value="20">20 seconds</option>
  <option value="25">25 seconds</option>
  <option value="30">30 seconds</option>
  <option value="35">35 seconds</option>
  <option value="40">40 seconds</option>
  <option value="45">45 seconds</option>
  <option value="50">50 seconds</option>
  <option value="55">55 seconds</option>
  <option value="60">60 seconds</option>
  <option value="custom">Custom</option>
</select>
<input type="number" id="customInterval" placeholder="seconds" min="1">

<br>
<button onclick="copyAllAtInterval()">Start Copy (F1)</button>
<button onclick="togglePause()">Pause/Resume (F2)</button>
<button onclick="stopCopy()">Stop (F3)</button>
<button onclick="manualNext()">Manual Next</button>

<div id="ndcContainer"></div>
<div id="status"></div>

<script>
let ndcCount = 0;
let copyTimer = null;
let values = [];
let index = 0;
let interval = 10000;
let paused = false;

// Add new NDC input row
function addNDCInput() {
  ndcCount++;
  const container = document.getElementById('ndcContainer');
  const row = document.createElement('div');
  row.className = 'ndc-row';
  row.id = 'row-' + ndcCount;

  row.innerHTML = `
    <input type="text" class="ndcInput" placeholder="12345-6789-01">
    <button onclick="copyToClipboard(${ndcCount})">Copy NDC</button>
  `;

  container.appendChild(row);

  const input = row.querySelector('.ndcInput');
  input.addEventListener('input', () => {
    formatNDC(input);
    validateNDC(input);
  });
}

// Format NDC as 5-4-2 (hyphens after 5th & 9th digits)
function formatNDC(input) {
  let cursorPos = input.selectionStart;
  let digits = input.value.replace(/\D/g, '').slice(0, 11); // only 11 digits allowed

  let formatted = '';
  for (let i = 0; i < digits.length; i++) {
    if (i === 5 || i === 9) formatted += '-';
    formatted += digits[i];
  }

  input.value = formatted;

  if (cursorPos > formatted.length) cursorPos = formatted.length;
  input.selectionStart = input.selectionEnd = cursorPos;
}

// Validate input (red/green border)
function validateNDC(input) {
  let digits = input.value.replace(/\D/g, '');
  if (digits.length === 11) {
    input.classList.add('valid');
    input.classList.remove('invalid');
  } else {
    input.classList.add('invalid');
    input.classList.remove('valid');
  }
}

// Copy single NDC
function copyToClipboard(id) {
  const input = document.querySelector(`#row-${id} .ndcInput`);
  const ndc = input.value.trim();
  if (!ndc) { alert("Nothing to copy!"); return; }

  navigator.clipboard.writeText(ndc).then(() => {
    document.getElementById('status').textContent = "Copied: " + ndc;
  });
}

// Start automatic copy cycle
function copyAllAtInterval() {
  const inputs = document.querySelectorAll('.ndcInput');
  values = Array.from(inputs).map(input => input.value.trim()).filter(v => v);

  if (values.length === 0) {
    alert("No NDCs to copy!");
    return;
  }

  let intervalValue = document.getElementById('intervalSelect').value;
  if (intervalValue === "custom") {
    let customSeconds = parseInt(document.getElementById('customInterval').value, 10);
    if (isNaN(customSeconds) || customSeconds < 1) {
      alert("Please enter a valid custom interval (min 1 sec)");
      return;
    }
    interval = customSeconds * 1000;
  } else {
    interval = parseInt(intervalValue, 10) * 1000;
  }

  index = 0;
  paused = false;
  document.getElementById('status').textContent = `Starting... (0 of ${values.length})`;
  runCopy();
}

// Automatic copy loop
function runCopy() {
  if (paused) return;

  if (index >= values.length) {
    clearTimeout(copyTimer);
    copyTimer = null;
    document.getElementById('status').textContent = `‚úÖ Finished copying all ${values.length} NDCs!`;
    return;
  }

  const ndc = values[index];
  navigator.clipboard.writeText(ndc).then(() => {
    document.getElementById('status').textContent = `Copied ${index + 1} of ${values.length}: ${ndc}`;
  });
  index++;

  copyTimer = setTimeout(runCopy, interval);
}

// Manual next button
function manualNext() {
  if (values.length === 0) {
    const inputs = document.querySelectorAll('.ndcInput');
    values = Array.from(inputs).map(input => input.value.trim()).filter(v => v);
    index = 0;
  }
  if (index < values.length) {
    const ndc = values[index];
    navigator.clipboard.writeText(ndc).then(() => {
      document.getElementById('status').textContent = `üìã Manually copied ${index + 1} of ${values.length}: ${ndc}`;
    });
    index++;
  } else {
    document.getElementById('status').textContent = "‚úÖ All NDCs manually copied.";
  }
}

// Pause/Resume
function togglePause() {
  if (paused) {
    paused = false;
    document.getElementById('status').textContent = "‚ñ∂Ô∏è Resuming...";
    runCopy();
  } else {
    if (copyTimer) {
      clearTimeout(copyTimer);
      copyTimer = null;
    }
    paused = true;
    document.getElementById('status').textContent = "‚è∏ Paused at " + index + " of " + values.length;
  }
}

// Stop process
function stopCopy() {
  clearTimeout(copyTimer);
  copyTimer = null;
  paused = false;
  document.getElementById('status').textContent = "‚èπ Stopped.";
}

// Show custom interval field
document.getElementById('intervalSelect').addEventListener('change', function() {
  document.getElementById('customInterval').style.display = this.value === "custom" ? "inline-block" : "none";
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  if (e.key === "F1") {
    e.preventDefault(); copyAllAtInterval();
  } else if (e.key === "F2") {
    e.preventDefault(); togglePause();
  } else if (e.key === "F3") {
    e.preventDefault(); stopCopy();
  }
});

// Start with one input
addNDCInput();
</script>

</body>
</html>
