<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>11-Digit NDC to QR Codes</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  input, button { padding: 10px; font-size: 16px; margin: 5px 0; }
  .ndc-row { margin-bottom: 20px; }
  .qrcode-container { margin-top: 10px; }
</style>
</head>
<body>

<h2>11-Digit NDC to QR Codes</h2>
<button onclick="addNDCInput()">Add NDC Input</button>

<div id="ndcContainer"></div>

<!-- Include QRCode.js library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
let ndcCount = 0;

function addNDCInput() {
  ndcCount++;
  const container = document.getElementById('ndcContainer');

  const row = document.createElement('div');
  row.className = 'ndc-row';
  row.id = 'row-' + ndcCount;

  row.innerHTML = `
    <input type="text" class="ndcInput" placeholder="12345-6789-01" maxlength="12">
    <button onclick="generateQRCode(${ndcCount})">Generate QR</button>
    <button onclick="copyToClipboard(${ndcCount})">Copy NDC</button>
    <div class="qrcode-container" id="qrcode-${ndcCount}"></div>
  `;

  container.appendChild(row);

  const input = row.querySelector('.ndcInput');
  input.addEventListener('input', () => {
    // Keep only digits
    let value = input.value.replace(/\D/g, '');

    // Limit to 11 digits
    if (value.length > 11) value = value.slice(0,11);

    // Automatically insert hyphens: 5-4-2
    if (value.length > 5 && value.length <= 9) {
      value = value.slice(0,5) + '-' + value.slice(5);
    } else if (value.length > 9) {
      value = value.slice(0,5) + '-' + value.slice(5,9) + '-' + value.slice(9,11);
    }

    input.value = value;
  });
}

function generateQRCode(id) {
  const input = document.querySelector(`#row-${id} .ndcInput`);
  const ndc = input.value.trim();

  // Only allow exactly 11 digits (ignoring hyphens)
  const digits = ndc.replace(/\D/g, '');
  if (digits.length !== 11) {
    alert("Please enter a valid 11-digit NDC!");
    return;
  }

  const qrcodeDiv = document.getElementById('qrcode-' + id);
  qrcodeDiv.innerHTML = "";
  new QRCode(qrcodeDiv, {
    text: ndc,
    width: 200,
    height: 200,
    colorDark: "#000000",
    colorLight: "#ffffff",
    correctLevel: QRCode.CorrectLevel.H
  });
}

function copyToClipboard(id) {
  const input = document.querySelector(`#row-${id} .ndcInput`);
  const ndc = input.value.trim();
  const digits = ndc.replace(/\D/g, '');
  if (digits.length !== 11) { 
    alert("Cannot copy: NDC must be 11 digits!");
    return; 
  }

  navigator.clipboard.writeText(ndc).then(() => {
    alert("NDC copied to clipboard!");
  }).catch(err => {
    alert("Failed to copy: " + err);
  });
}

// Start with one input by default
addNDCInput();
</script>

</body>
</html>
