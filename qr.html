<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visual QR Builder Print</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
body { font-family: system-ui, Arial, sans-serif; margin: 20px; background:#f6f7fb; }
h1 { font-size: 18px; margin-bottom:10px; }
input, label { padding: 6px; margin-right: 10px; margin-bottom:10px; }
#palette, #sequence { display:flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.draggable { padding:8px 12px; background:#1f7aed; color:white; border:none; border-radius:6px; cursor:pointer; user-select:none; }
.dropzone { min-height:50px; padding:10px; border:2px dashed #aaa; border-radius:8px; background:#fff; display:flex; gap:6px; flex-wrap: wrap; }
.block { padding:6px 10px; background:#4caf50; color:white; border-radius:4px; cursor: grab; }
canvas { margin-top:16px; border:1px solid #ccc; display:block; }
#qrLabel { font-weight:600; margin-top:6px; font-size:16px; text-align:center; }
.controls { margin-top:12px; display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
button { padding:8px 12px; border:none; border-radius:6px; background:#1f7aed; color:white; cursor:pointer; }
button:active { transform:translateY(1px); }

/* Print layout */
@media print {
  body * { visibility: hidden; } /* hide everything */
  #printArea, #printArea * { visibility: visible; } /* show only QR + label */
  #printArea { 
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    border: 2px solid #000;
    padding: 20px;
    page-break-inside: avoid;
  }
  canvas { border: none !important; }
}
</style>
</head>
<body>
<h1>Visual QR Builder Print</h1>

<input id="usernameInput" placeholder="Username">
<input id="passwordInput" placeholder="Password">
<input id="labelInput" placeholder="QR Label">

<h3>Drag items to sequence:</h3>
<div id="palette">
  <button class="draggable" data-type="username">Username</button>
  <button class="draggable" data-type="password">Password</button>
  <button class="draggable" data-type="tab">Tab</button>
  <button class="draggable" data-type="enter">Enter</button>
</div>

<div id="sequence" class="dropzone"></div>

<div class="controls">
  <label>QR Size: <span id="sizeValue">256</span> px</label>
  <input type="range" id="qrSize" min="64" max="512" value="256">
  <button id="generate">Generate QR</button>
  <button id="printBtn">Print QR</button>
  <button id="clearBtn">Clear</button>
</div>

<!-- QR + label container for printing -->
<div id="printArea">
  <canvas id="qrCanvas" width="256" height="256"></canvas>
  <div id="qrLabel"></div>
</div>

<script>
const palette = document.getElementById('palette');
const sequence = document.getElementById('sequence');
const usernameInput = document.getElementById('usernameInput');
const passwordInput = document.getElementById('passwordInput');
const labelInput = document.getElementById('labelInput');
const canvas = document.getElementById('qrCanvas');
const qrLabel = document.getElementById('qrLabel');
const generateBtn = document.getElementById('generate');
const qrSizeSlider = document.getElementById('qrSize');
const sizeValue = document.getElementById('sizeValue');
const printBtn = document.getElementById('printBtn');
const clearBtn = document.getElementById('clearBtn');

let draggedType = null;

// Drag & Drop setup
palette.querySelectorAll('.draggable').forEach(btn => {
  btn.setAttribute('draggable', true);
  btn.addEventListener('dragstart', e => {
    draggedType = e.target.dataset.type;
  });
});

sequence.addEventListener('dragover', e => e.preventDefault());
sequence.addEventListener('drop', e => {
  e.preventDefault();
  if (!draggedType) return;
  const block = document.createElement('div');
  block.className = 'block';
  block.textContent = draggedType;
  block.dataset.type = draggedType;
  block.setAttribute('draggable', true);
  block.addEventListener('dragstart', e => block.classList.add('dragging'));
  block.addEventListener('dragend', e => block.classList.remove('dragging'));
  sequence.appendChild(block);
  draggedType = null;
});

// QR Size slider
qrSizeSlider.addEventListener('input', () => {
  sizeValue.textContent = qrSizeSlider.value;
});

// Build payload from sequence
function buildPayload() {
  let payload = '';
  sequence.querySelectorAll('.block').forEach(block => {
    switch(block.dataset.type){
      case 'username': payload += usernameInput.value; break;
      case 'password': payload += passwordInput.value; break;
      case 'tab': payload += '\t'; break;
      case 'enter': payload += '\r'; break;
    }
  });
  return payload;
}

// Generate QR
generateBtn.addEventListener('click', () => {
  const payload = buildPayload();
  const size = parseInt(qrSizeSlider.value, 10);
  canvas.width = canvas.height = size;
  qrLabel.textContent = labelInput.value || '';
  QRCode.toCanvas(canvas, payload, { errorCorrectionLevel:'M', width:size }, err => {
    if(err) console.error(err);
  });
});

// Print
printBtn.addEventListener('click', () => {
  window.print();
});

// Clear
clearBtn.addEventListener('click', () => {
  sequence.innerHTML = '';
  usernameInput.value = '';
  passwordInput.value = '';
  labelInput.value = '';
  qrLabel.textContent = '';
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
});

// Suppress all function keys F1â€“F12
window.addEventListener('keydown', (e) => {
  if (e.key.startsWith('F')) {
    const num = parseInt(e.key.slice(1), 10);
    if (!isNaN(num) && num >= 1 && num <= 12) {
      e.preventDefault();  // Stop browser default
      e.stopPropagation(); // Stop event bubbling
      console.log(`Function key F${num} suppressed`);
    }
  }
}, {passive:false});

</script>
</body>
</html>
